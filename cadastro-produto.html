<main class="flex-grow main-container mt-20 p-8 bg-white rounded-xl shadow-xl">
        <div id="messageBox" class="mt-4 p-4 rounded-lg text-center hidden"></div>
    </main>

    <section class="main-container p-8">
        <h3 class="text-2xl font-bold text-gray-800 mb-6 border-b pb-2">Itens Recentes Cadastrados (Últimos 10)</h3>
        
        <div class="overflow-x-auto bg-white rounded-xl shadow-xl">
            <table class="min-w-full divide-y divide-gray-200">
                <thead class="bg-gray-50">
                    <tr>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Código</th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Modelo</th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Marca</th>
                        <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Custo</th>
                        <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Venda</th>
                        <th class="px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">Qtd</th>
                    </tr>
                </thead>
                <tbody id="recentProductsTableBody" class="bg-white divide-y divide-gray-200">
                    <tr><td colspan="6" class="px-6 py-4 text-center text-gray-400">Carregando produtos...</td></tr>
                </tbody>
            </table>
        </div>
    </section>
    <footer class="bg-gray-800 text-white py-4 mt-auto">
    ```

## 2. Atualização do `script.js` (Refatoração da Listagem)

Refatoramos a lógica de listagem (que estava em `window.setupProdutosPage`) para uma função reutilizável.

### `script.js` (Versão Corrigida e Refatorada)

```javascript
// script.js

function isFirebaseReady() {
    return typeof db !== 'undefined' && typeof auth !== 'undefined';
}

// NOVO: Função genérica para listar produtos em qualquer lugar
// 'tableBodyId': o ID do <tbody> onde os dados devem ser injetados
// 'limitCount': Limita o número de itens (para a lista de 'recentes')
function setupProductListing(tableBodyId, limitCount = null) {
    const tbody = document.getElementById(tableBodyId);
    
    // Sai da função se o elemento não existir na página (ex: se estiver no index.html)
    if (!tbody) return;

    // Constrói a consulta ao Firestore
    let produtosQuery = firebase.firestore().collection('produtos')
                                .orderBy('criadoEm', 'desc');

    // Aplica limite se for a lista de itens recentes (cadastro-produto.html)
    if (limitCount !== null) {
        produtosQuery = produtosQuery.limit(limitCount);
    }

    produtosQuery.onSnapshot((snapshot) => {
        tbody.innerHTML = '';

        if (snapshot.empty) {
            tbody.innerHTML = `
                <tr>
                    <td colspan="6" class="px-6 py-4 text-center text-gray-500 italic">
                        Nenhum produto cadastrado ainda.
                    </td>
                </tr>
            `;
            return;
        }

        snapshot.forEach(doc => {
            const p = doc.data();
            const row = document.createElement('tr');
            row.innerHTML = `
                <td class="px-6 py-4 font-mono text-sm">${p.codigo}</td>
                <td class="px-6 py-4">${p.modelo}</td>
                <td class="px-6 py-4">${p.marca}</td>
                <td class="px-6 py-4 text-right text-red-600 font-semibold">R$ ${p.custo.toFixed(2)}</td>
                <td class="px-6 py-4 text-right text-green-700 font-bold">R$ ${p.venda.toFixed(2)}</td>
                <td class="px-6 py-4 text-center">${p.quantidade}</td>
            `;
            tbody.appendChild(row);
        });
    });
}


export function setupCadastroProduto(user) { 
    const form = document.getElementById('cadastroForm');
    const custoInput = document.getElementById('custoInput');
    const margemInput = document.getElementById('margemInput');
    const precoVendaInput = document.getElementById('precoVendaInput');

    function calcularPrecoVenda() {
        const custo = parseFloat(custoInput.value) || 0;
        const margem = parseFloat(margemInput.value) || 0;
        const venda = custo + (custo * margem / 100);
        precoVendaInput.value = venda.toFixed(2);
    }

    calcularPrecoVenda(); 
    custoInput.addEventListener('input', calcularPrecoVenda);
    margemInput.addEventListener('input', calcularPrecoVenda);

    form.addEventListener('submit', async (e) => {
        e.preventDefault();

        if (!isFirebaseReady() || !user) { 
            alert("Erro: O Firebase não está inicializado ou o usuário não está autenticado.");
            return;
        }

        const codigo = document.getElementById('codigoBarras').value;
        const marca = document.getElementById('marca').value;
        const modelo = document.getElementById('modelo').value;
        const custo = parseFloat(custoInput.value);
        const margem = parseFloat(margemInput.value);
        const venda = parseFloat(precoVendaInput.value);
        const quantidade = parseInt(document.getElementById('productQuantity').value);

        try {
            console.log("Salvando produto...");
            
            const docRef = await firebase.firestore().collection('produtos').add({ 
                codigo,
                marca,
                modelo,
                custo,
                margem,
                venda,
                quantidade,
                criadoPor: user.uid, 
                criadoEm: new Date()
            });
            
            console.log("Produto salvo com ID:", docRef.id);

            const box = document.getElementById('messageBox');
            box.textContent = '✅ Produto cadastrado com sucesso! A lista abaixo será atualizada.';
            box.classList.remove('hidden', 'bg-red-100', 'text-red-700');
            box.classList.add('bg-green-100', 'text-green-700');
            form.reset();
            precoVendaInput.value = '0.00';
            calcularPrecoVenda();
            
            // A lista de produtos recentes (setupProductListing) atualizará automaticamente via onSnapshot
            
        } catch (error) {
            console.error("Erro ao salvar produto:", error);
            const box = document.getElementById('messageBox');
            box.textContent = '❌ Erro ao salvar produto. (Verifique o console e as regras do Firebase!)';
            box.classList.remove('hidden', 'bg-green-100', 'text-green-700');
            box.classList.add('bg-red-100', 'text-red-700');
        }
    });
    
    // NOVO: Inicia a listagem de produtos recentes para o cadastro-produto.html (limite de 10)
    setupProductListing('recentProductsTableBody', 10);
}

// ATUALIZADO: Função original de listagem para produtos.html
window.setupProdutosPage = function () {
    // Listagem completa (sem limite)
    setupProductListing('productsTableBody', null);
    
    // Lógica para mostrar o total (se o elemento existir)
    const loadingStatus = document.getElementById('loadingStatus');
    if (loadingStatus) {
        firebase.firestore().collection('produtos').onSnapshot((snapshot) => {
            loadingStatus.textContent = `Total de produtos: ${snapshot.size}`;
        });
    }
};
